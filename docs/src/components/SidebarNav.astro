---
import { components } from '../data/components/index';

interface Props {
  activeSlug?: string;
}

const { activeSlug } = Astro.props;

const tiers = [
  { key: 'layout', label: 'Layout' },
  { key: 'navigation', label: 'Navigation' },
  { key: 'content', label: 'Content' },
  { key: 'input', label: 'Input' },
  { key: 'feedback', label: 'Feedback' },
] as const;

const byTier = Object.fromEntries(
  tiers.map(t => [t.key, components.filter(c => c.tier === t.key).sort((a, b) => a.name.localeCompare(b.name))])
);

const activeTier = activeSlug
  ? components.find(c => c.slug === activeSlug)?.tier
  : undefined;

/* Build active href for the sidebar component */
const activeHref = activeSlug
  ? (components.find(c => c.slug === activeSlug)
      ? `/components/${activeSlug}`
      : `/${activeSlug}`)
  : '';
---

<arc-sidebar slot="sidebar" active={activeHref} glow>
  <arc-sidebar-section heading="Guide">
    <arc-sidebar-link href="/getting-started" active={activeSlug === 'getting-started' || undefined}>Getting Started</arc-sidebar-link>
    <arc-sidebar-link href="/frameworks" active={activeSlug === 'frameworks' || undefined}>Frameworks</arc-sidebar-link>
    <arc-sidebar-link href="/tokens" active={activeSlug === 'tokens' || undefined}>Design Tokens</arc-sidebar-link>
    <arc-sidebar-link href="/theming" active={activeSlug === 'theming' || undefined}>Theming</arc-sidebar-link>
    <arc-sidebar-link href="/theme-synthesizer" active={activeSlug === 'theme-synthesizer' || undefined}>Theme Synthesizer</arc-sidebar-link>
    <arc-sidebar-link href="/accessibility" active={activeSlug === 'accessibility' || undefined}>Accessibility</arc-sidebar-link>
    <arc-sidebar-link href="/browser-support" active={activeSlug === 'browser-support' || undefined}>Browser Support</arc-sidebar-link>
    <arc-sidebar-link href="/changelog" active={activeSlug === 'changelog' || undefined}>Changelog</arc-sidebar-link>
    <arc-sidebar-link href="/contributing" active={activeSlug === 'contributing' || undefined}>Contributing</arc-sidebar-link>
    <arc-sidebar-link href="/components" active={activeSlug === 'components' || undefined}>All Components</arc-sidebar-link>
  </arc-sidebar-section>

  {tiers.map((tier) => (
    <arc-sidebar-section
      heading={tier.label}
      collapsible
      open={activeTier === tier.key || !activeTier || undefined}
    >
      {byTier[tier.key].map((c) => (
        <arc-sidebar-link
          href={`/components/${c.slug}`}
          active={activeSlug === c.slug || undefined}
        >{c.name}</arc-sidebar-link>
      ))}
    </arc-sidebar-section>
  ))}
</arc-sidebar>
