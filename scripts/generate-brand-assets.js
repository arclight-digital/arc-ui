#!/usr/bin/env node

/**
 * Reads SVG files from packages/brand/src/assets/svg/ and generates
 * packages/brand/src/assets/logo.js with named exports for each file.
 *
 * e.g. logo-sm.svg → export const logoSm = svg`...`;
 *      logo-lg.svg → export const logoLg = svg`...`;
 */

import fs from 'fs';
import path from 'path';

const SVG_DIR = 'packages/brand/src/assets/svg';
const OUT_FILE = 'packages/brand/src/assets/logo.js';

if (!fs.existsSync(SVG_DIR)) {
  fs.mkdirSync(SVG_DIR, { recursive: true });
  console.log(`Created ${SVG_DIR}/ — drop your SVG files there and re-run.`);
  process.exit(0);
}

const files = fs.readdirSync(SVG_DIR).filter(f => f.endsWith('.svg')).sort();

if (files.length === 0) {
  console.log(`No .svg files found in ${SVG_DIR}/`);
  process.exit(0);
}

/** kebab-case filename to camelCase export name: logo-sm → logoSm */
function toCamelCase(name) {
  return name.replace(/-([a-z])/g, (_, c) => c.toUpperCase());
}

let output = '// Generated by scripts/generate-brand-assets.js — do not edit by hand\n';
output += "import { svg } from 'lit';\n\n";

for (const file of files) {
  const name = path.basename(file, '.svg');
  const exportName = toCamelCase(name);
  let content = fs.readFileSync(path.join(SVG_DIR, file), 'utf8').trim();

  // Strip XML declaration and DOCTYPE — not valid inside Lit svg`` templates
  content = content.replace(/<\?xml[^?]*\?>\s*/g, '');
  content = content.replace(/<!DOCTYPE[^>]*>\s*/g, '');

  // Replace hardcoded brand colors with currentColor for theme support
  content = content.replace(/#e8e8ec/gi, 'currentColor');
  content = content.replace(/#e8e8f4/gi, 'currentColor');
  content = content.replace(/#adadb0/gi, 'currentColor');

  // Escape backticks and ${} in SVG content
  content = content.replace(/`/g, '\\`').replace(/\$\{/g, '\\${');

  output += `export const ${exportName} = svg\`${content}\`;\n\n`;
}

fs.writeFileSync(OUT_FILE, output);
console.log(`Generated ${OUT_FILE} with ${files.length} export(s): ${files.join(', ')}`);
